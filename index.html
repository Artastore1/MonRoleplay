<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Masukkan Nama - Pterodactyl API</title>
    <style>
        body {
            background-color: #1a1a1a;
            color: #ffffff;
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 50px;
        }
        h1 {
            color: #ffcc00;
        }
        form {
            background-color: #333333;
            padding: 20px;
            border-radius: 10px;
            display: inline-block;
        }
        label, input {
            display: block;
            margin: 10px 0;
        }
        input[type="text"] {
            padding: 10px;
            border: none;
            border-radius: 5px;
            width: 200px;
        }
        button {
            background-color: #ffcc00;
            color: #1a1a1a;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #e6b800;
        }
    </style>
</head>
<body>
    <h1>Masukkan Nama Anda</h1>
    <form id="nameForm">
        <label for="username">Nama:</label>
        <input type="text" id="username" name="username" required>
        <button type="submit">Submit</button>
    </form>

    <script>
        document.getElementById('nameForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;

            fetch('index.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ username: username }),
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });
    </script>

    <?php
    if ($_SERVER['REQUEST_METHOD'] === 'POST') {
        $input = json_decode(file_get_contents('php://input'), true);
        $username = $input['username'];

        $api_url = 'https://digimon.cloud.kapakhost.my.id/api/client/servers/5563a606/files#/home/container/scriptfiles/whitelist';
        $api_key = 'ptlc_p9emf3fbaEbmXWStU0fVbwtjGvciyzWK6y4aY7P6Dgh'; // Ganti dengan API key Pterodactyl Anda

        $filename = /home/container/scriptfiles/whitelist/' . $username . '.txt';
        $content = $username;

        $data = [
            'root' => '/',
            'file' => $filename,
            'content' => base64_encode($content)
        ];

        $ch = curl_init($api_url);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        curl_setopt($ch, CURLOPT_HTTPHEADER, [
            'Authorization: Bearer ' . $api_key,
            'Content-Type: application/json',
            'Accept: application/json',
        ]);
        curl_setopt($ch, CURLOPT_POST, true);
        curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($data));

        $response = curl_exec($ch);
        $http_code = curl_getinfo($ch, CURLINFO_HTTP_CODE);
        curl_close($ch);

        if ($http_code === 200) {
            echo json_encode(['message' => 'Nama berhasil ditambahkan ke whitelist.']);
        } else {
            echo json_encode(['message' => 'Gagal menambahkan nama ke whitelist.', 'response' => $response]);
        }
    } else {
        echo json_encode(['message' => 'Metode request tidak valid.']);
    }
    ?>
</body>
</html>
